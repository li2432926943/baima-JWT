import{u as A,b as a,d as F,r as _,o as u,c as d,e as o,a as s,f as E,w as l,k as y,m as G,t as b,i as P,n as H,E as C,p as N}from"./index-c67db3df.js";import{a as U}from"./anime-bg-a5ff5050.js";import{_ as J}from"./_plugin-vue_export-helper-c27b6911.js";const K={class:"forget-container"},O={class:"forget-banner"},Q={class:"forget-form-container"},W={class:"forget-form-wrapper"},X={key:0},Y={key:0,class:"error-tip"},Z={class:"verify-code-wrapper"},h={key:0,class:"error-tip"},ee={key:1},re={key:0,class:"error-tip"},se={key:0,class:"error-tip"},oe={__name:"ForgetPage",setup(te){const B=A(),I=a(null),S=a(null),R=a(1),c=a(!1),k=a("获取验证码");let T=null;const i=a(""),m=a(""),v=a(""),g=a(""),r=F({email:"",verifyCode:""}),t=F({newPassword:"",confirmPassword:""}),D=F({email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],verifyCode:[{required:!0,message:"请输入验证码",trigger:"blur"},{min:6,max:6,message:"验证码长度应为6位",trigger:"blur"}]}),L=F({newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度至少为6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(f,e,p)=>{e!==t.newPassword?p(new Error("两次输入的密码不一致")):p()},trigger:"blur"}]}),M=async()=>{if(i.value="",!r.email){i.value="请先输入邮箱地址";return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.email)){i.value="请输入正确的邮箱地址";return}if(c.value)return;c.value=!0;let e=60;H(`/api/auth/ask-code?email=${r.email}&type=reset`,()=>{C.success(`验证码已发送至邮箱: ${r.email}，请注意查收`),k.value=`${e}秒后重新获取`,T=setInterval(()=>{e--,k.value=`${e}秒后重新获取`,e<=0&&(clearInterval(T),k.value="获取验证码",c.value=!1)},1e3)},p=>{C.warning(p),c.value=!1})},j=async()=>{if(i.value="",m.value="",!r.email){i.value="请输入邮箱地址";return}if(!r.verifyCode){m.value="请输入验证码";return}if(r.verifyCode.length!==6){m.value="验证码长度应为6位";return}N("/api/auth/reset-confirm",{email:r.email,code:r.verifyCode},()=>{C.success("验证码验证通过"),R.value=2},f=>{m.value=f})},z=async()=>{if(v.value="",g.value="",!t.newPassword){v.value="请输入新密码";return}if(t.newPassword.length<6){v.value="密码长度至少为6位";return}if(!t.confirmPassword){g.value="请确认新密码";return}if(t.newPassword!==t.confirmPassword){g.value="两次输入的密码不一致";return}N("/api/auth/reset-password",{email:r.email,code:r.verifyCode,password:t.newPassword},()=>{C.success("密码重置成功"),setTimeout(()=>{B.push("/")},2e3)},f=>{C.error(f)})},$=()=>{B.push("/")};return(f,e)=>{const p=_("el-image"),V=_("el-input"),x=_("el-form-item"),w=_("el-button"),q=_("el-form");return u(),d("div",K,[o("div",O,[s(p,{class:"background-image",src:E(U),fit:"cover","preview-teleported":!0,"preview-src-list":[E(U)]},null,8,["src","preview-src-list"]),e[4]||(e[4]=o("div",{class:"welcome-text"},[o("h1",null,"找回密码"),o("p",null,"别担心，我们会帮助您重置密码")],-1))]),o("div",Q,[o("div",W,[R.value===1?(u(),d("div",X,[e[7]||(e[7]=o("h2",{class:"forget-title"},"重置密码",-1)),e[8]||(e[8]=o("p",{class:"forget-desc"},"请输入需要重置密码的电子邮件地址",-1)),s(q,{model:r,class:"forget-form",rules:D,ref_key:"emailFormRef",ref:I},{default:l(()=>[s(x,{prop:"email",class:"no-error-margin"},{default:l(()=>[s(V,{modelValue:r.email,"onUpdate:modelValue":e[0]||(e[0]=n=>r.email=n),"prefix-icon":E(G),placeholder:"请输入合法的电子邮件地址"},null,8,["modelValue","prefix-icon"]),i.value?(u(),d("div",Y,b(i.value),1)):y("",!0)]),_:1}),s(x,{prop:"verifyCode",class:"verify-code-item no-error-margin"},{default:l(()=>[o("div",Z,[s(V,{modelValue:r.verifyCode,"onUpdate:modelValue":e[1]||(e[1]=n=>r.verifyCode=n),placeholder:"请输入验证码"},null,8,["modelValue"]),s(w,{class:"verify-code-btn",type:"primary",disabled:c.value,onClick:M},{default:l(()=>[P(b(k.value),1)]),_:1},8,["disabled"])]),m.value?(u(),d("div",h,b(m.value),1)):y("",!0)]),_:1}),s(w,{type:"primary",class:"submit-button",onClick:j},{default:l(()=>e[5]||(e[5]=[P("验证并继续")])),_:1})]),_:1},8,["model","rules"]),e[9]||(e[9]=o("div",{class:"divider"},[o("span",null,"或者")],-1)),s(w,{class:"back-button",onClick:$},{default:l(()=>e[6]||(e[6]=[P("返回登录")])),_:1})])):R.value===2?(u(),d("div",ee,[e[12]||(e[12]=o("h2",{class:"forget-title"},"设置新密码",-1)),e[13]||(e[13]=o("p",{class:"forget-desc"},"验证成功，请设置您的新密码",-1)),s(q,{model:t,class:"forget-form",rules:L,ref_key:"passwordFormRef",ref:S},{default:l(()=>[s(x,{prop:"newPassword",class:"no-error-margin"},{default:l(()=>[s(V,{modelValue:t.newPassword,"onUpdate:modelValue":e[2]||(e[2]=n=>t.newPassword=n),type:"password",placeholder:"请输入新密码"},null,8,["modelValue"]),v.value?(u(),d("div",re,b(v.value),1)):y("",!0)]),_:1}),s(x,{prop:"confirmPassword",class:"no-error-margin"},{default:l(()=>[s(V,{modelValue:t.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=n=>t.confirmPassword=n),type:"password",placeholder:"请确认新密码"},null,8,["modelValue"]),g.value?(u(),d("div",se,b(g.value),1)):y("",!0)]),_:1}),s(w,{type:"primary",class:"submit-button",onClick:z},{default:l(()=>e[10]||(e[10]=[P("确认重置")])),_:1})]),_:1},8,["model","rules"]),e[14]||(e[14]=o("div",{class:"divider"},[o("span",null,"或者")],-1)),s(w,{class:"back-button",onClick:$},{default:l(()=>e[11]||(e[11]=[P("返回登录")])),_:1})])):y("",!0)])])])}}},ne=J(oe,[["__scopeId","data-v-f1853384"]]);export{ne as default};
