import{_ as P}from"./_plugin-vue_export-helper-c27b6911.js";import{r as i,o as b,c as k,e as n,a as l,w as t,B as R,D as O,i as f,t as v,k as Z,s as W,$ as X,b as y,d as C,z as Y,A as ee,f as p,a0 as le,g as te,a1 as ae,m as oe,a2 as se,a3 as ne,p as N,n as ie,E as c}from"./index-c67db3df.js";import{u as de}from"./index-c2928ce0.js";const re={class:"card"},ue={key:0,class:"card-header"},me={__name:"Card",props:{icon:Object,title:String,desc:String},setup(x){return(u,S)=>{const V=i("el-icon");return b(),k("div",re,[x.title?(b(),k("div",ue,[n("div",null,[l(V,{style:{"margin-right":"3px",translate:"0 2px"}},{default:t(()=>[(b(),R(O(x.icon)))]),_:1}),f(" "+v(x.title),1)]),n("div",null,v(x.desc),1)])):Z("",!0),W(u.$slots,"default",{},void 0,!0)])}}},U=P(me,[["__scopeId","data-v-5edc9f21"]]);const pe={style:{display:"flex","max-width":"950px",margin:"auto"}},ce={class:"settings-left"},_e={class:"settings-right"},fe={style:{position:"sticky",top:"20px"}},ge={style:{"text-align":"center",padding:"5px 15px 0 15px"}},ve={style:{margin:"5px 0"}},xe={style:{"font-weight":"bold"}},ye={style:{"font-size":"14px",color:"grey",padding:"10px"}},be={__name:"UserSettingPage",setup(x){const u=de(),S=X(()=>new Date(u.user.registerTime).toLocaleString()),V=y(""),q=y(),h=y(),a=C({username:"",gender:1,phone:"",qq:"",wx:"",desc:""}),r=C({email:"",code:""}),$={username:[{validator:(o,e,d)=>{e===""?d(new Error("请输入用户名")):/^[a-zA-Z0-9\u4e00-\u9fa5]+$/.test(e)?d():d(new Error("用户名不能包含特殊字符，只能是中文/英文"))},trigger:["blur","change"]},{min:2,max:10,message:"用户名的长度必须在2-10个字符之间",trigger:["blur","change"]}],email:[{required:!0,message:"请输入邮件地址",trigger:"blur"},{type:"email",message:"请输入合法的电子邮件地址",trigger:["blur","change"]}]},g=C({form:!0,base:!1});function F(){q.value.validate(o=>{o&&(g.base=!0,N("/api/user/save-details",a,()=>{c.success("用户信息保存成功"),u.user.usernamew=a.username,V.value=a.desc,g.base=!1},e=>{c.warning(e),g.base=!1}))})}g.form=!1;const _=y(0),E=y(!0),I=(o,e)=>{o==="email"&&(E.value=e)};function T(){h.value.validate(o=>{o&&(_.value=60,ie(`/api/auth/ask-code?email=${r.email}&type=modify`,()=>{c.success(`验证码已成功发送到邮箱：${r.email}，请注意查收`);const e=setInterval(()=>{_.value--,_.value===0&&clearInterval(e)},1e3)},e=>{c.warning(e),_.value=0}))})}function A(){h.value.validate(o=>{o&&N("/api/user/modify-email",r,()=>{c.success("邮件修改成功"),u.user.email=r.email,r.code=""})})}function j(o){return o.type!=="image/jpeg"&&o.type!=="image/png"?(c.error("头像只能是 JPG/PNG 格式的"),!1):o.size/1024>100?(c.error("头像大小不能大于 100KB"),!1):!0}function G(o){c.success("头像上传成功"),u.user.avatar=o.data}return(o,e)=>{const d=i("el-input"),m=i("el-form-item"),z=i("el-radio"),L=i("el-radio-group"),w=i("el-button"),D=i("el-form"),B=i("el-col"),Q=i("el-row"),H=i("el-avatar"),J=i("el-upload"),K=i("el-divider"),M=Y("loading");return b(),k("div",pe,[n("div",ce,[ee((b(),R(U,{icon:p(te),title:"账号信息设置",desc:"在这里编辑您的个人信息，您可以在隐私设置中选择是否展示这些信息"},{default:t(()=>[l(D,{model:a,rules:$,ref_key:"baseFormRef",ref:q,"label-position":"top",style:{margin:"0 10px 10px 10px"}},{default:t(()=>[l(m,{label:"用户名",prop:"username"},{default:t(()=>[l(d,{modelValue:a.username,"onUpdate:modelValue":e[0]||(e[0]=s=>a.username=s),maxlength:"10"},null,8,["modelValue"])]),_:1}),l(m,{label:"性别"},{default:t(()=>[l(L,{modelValue:a.gender,"onUpdate:modelValue":e[1]||(e[1]=s=>a.gender=s)},{default:t(()=>[l(z,{label:0},{default:t(()=>e[8]||(e[8]=[f("男")])),_:1}),l(z,{label:1},{default:t(()=>e[9]||(e[9]=[f("女")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"手机号",prop:"phone"},{default:t(()=>[l(d,{modelValue:a.phone,"onUpdate:modelValue":e[2]||(e[2]=s=>a.phone=s),maxlength:"11"},null,8,["modelValue"])]),_:1}),l(m,{label:"QQ号",prop:"qq"},{default:t(()=>[l(d,{modelValue:a.qq,"onUpdate:modelValue":e[3]||(e[3]=s=>a.qq=s),maxlength:"13"},null,8,["modelValue"])]),_:1}),l(m,{label:"微信号",prop:"wx"},{default:t(()=>[l(d,{modelValue:a.wx,"onUpdate:modelValue":e[4]||(e[4]=s=>a.wx=s),maxlength:"20"},null,8,["modelValue"])]),_:1}),l(m,{label:"个人简介",prop:"desc"},{default:t(()=>[l(d,{modelValue:a.desc,"onUpdate:modelValue":e[5]||(e[5]=s=>a.desc=s),type:"textarea",rows:6,maxlength:"200"},null,8,["modelValue"])]),_:1}),n("div",null,[l(w,{icon:p(le),onClick:F,loading:g.base,type:"success"},{default:t(()=>e[10]||(e[10]=[f("保存用户信息 ")])),_:1},8,["icon","loading"])])]),_:1},8,["model"])]),_:1},8,["icon"])),[[M,g.form]]),l(U,{style:{"margin-top":"10px"},icon:p(oe),title:"电子邮件设置",desc:"您可以在这里修改默认绑定的电子邮件地址"},{default:t(()=>[l(D,{rules:$,onValidate:I,model:r,ref_key:"emailFormRef",ref:h,"label-position":"top",style:{margin:"0 10px 10px 10px"}},{default:t(()=>[l(m,{label:"电子邮件",prop:"email"},{default:t(()=>[l(d,{modelValue:r.email,"onUpdate:modelValue":e[6]||(e[6]=s=>r.email=s)},null,8,["modelValue"])]),_:1}),l(m,{prop:"code"},{default:t(()=>[l(Q,{style:{width:"100%"},gutter:10},{default:t(()=>[l(B,{span:18},{default:t(()=>[l(d,{placeholder:"请获取验证码",modelValue:r.code,"onUpdate:modelValue":e[7]||(e[7]=s=>r.code=s)},null,8,["modelValue"])]),_:1}),l(B,{span:6},{default:t(()=>[l(w,{type:"success",style:{width:"100%"},disabled:!E.value||_.value>0,onClick:T,plain:""},{default:t(()=>[f(v(_.value>0?`请稍后 ${_.value} 秒`:"获取验证码"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),n("div",null,[l(w,{icon:p(ae),type:"success",onClick:A},{default:t(()=>e[11]||(e[11]=[f("更新电子邮件")])),_:1},8,["icon"])])]),_:1},8,["model"])]),_:1},8,["icon"])]),n("div",_e,[n("div",fe,[l(U,null,{default:t(()=>[n("div",ge,[l(H,{size:70,src:p(u).avatarUrl},null,8,["src"]),n("div",ve,[l(J,{action:p(se).defaults.baseURL+"/api/image/avatar","show-file-list":!1,"before-upload":j,"on-success":G,headers:p(ne)()},{default:t(()=>[l(w,{size:"small",round:""},{default:t(()=>e[12]||(e[12]=[f("修改头像")])),_:1})]),_:1},8,["action","headers"])]),n("div",xe,"你好, "+v(p(u).user.username),1)]),l(K,{style:{margin:"10px 0"}}),n("div",ye,v(V.value||"这个用户很懒，没有填写个人简介~"),1)]),_:1}),l(U,{style:{"margin-top":"10px","font-size":"14px"}},{default:t(()=>[n("div",null,"账号注册时间: "+v(S.value),1),e[13]||(e[13]=n("div",{style:{color:"grey"}},"欢迎加入我们的学习论坛！",-1))]),_:1})])])])}}},Ce=P(be,[["__scopeId","data-v-78cc13b6"]]);export{Ce as default};
